<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dynlink (ocaml.Dynlink)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ocaml</a> &#x00BB; Dynlink</nav><header class="odoc-preamble"><h1>Module <code><span>Dynlink</span></code></h1><p>Dynamic loading of .cmo, .cma and .cmxs files.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#dynamic-loading-of-compiled-files">Dynamic loading of compiled files</a></li><li><a href="#access-control">Access control</a></li><li><a href="#error-reporting">Error reporting</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-is_native"><a href="#val-is_native" class="anchor"></a><code><span><span class="keyword">val</span> is_native : bool</span></code></div><div class="spec-doc"><p><code>true</code> if the program is native, <code>false</code> if the program is bytecode.</p></div></div><h2 id="dynamic-loading-of-compiled-files"><a href="#dynamic-loading-of-compiled-files" class="anchor"></a>Dynamic loading of compiled files</h2><div class="odoc-spec"><div class="spec value anchored" id="val-loadfile"><a href="#val-loadfile" class="anchor"></a><code><span><span class="keyword">val</span> loadfile : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>In bytecode: load the given bytecode object file (<code>.cmo</code> file) or bytecode library file (<code>.cma</code> file), and link it with the running program. In native code: load the given OCaml plugin file (usually <code>.cmxs</code>), and link it with the running program.</p><p>All toplevel expressions in the loaded compilation units are evaluated. No facilities are provided to access value names defined by the unit. Therefore, the unit must itself register its entry points with the main program (or a previously-loaded library) e.g. by modifying tables of functions.</p><p>An exception will be raised if the given library defines toplevel modules whose names clash with modules existing either in the main program or a shared library previously loaded with <code>loadfile</code>. Modules from shared libraries previously loaded with <code>loadfile_private</code> are not included in this restriction.</p><p>The compilation units loaded by this function are added to the &quot;allowed units&quot; list (see <a href="#val-set_allowed_units"><code>set_allowed_units</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loadfile_private"><a href="#val-loadfile_private" class="anchor"></a><code><span><span class="keyword">val</span> loadfile_private : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Same as <code>loadfile</code>, except that the compilation units just loaded are hidden (cannot be referenced) from other modules dynamically loaded afterwards.</p><p>An exception will be raised if the given library defines toplevel modules whose names clash with modules existing in either the main program or a shared library previously loaded with <code>loadfile</code>. Modules from shared libraries previously loaded with <code>loadfile_private</code> are not included in this restriction.</p><p>An exception will also be raised if the given library defines toplevel modules whose name matches that of an interface depended on by a module existing in either the main program or a shared library previously loaded with <code>loadfile</code>. This applies even if such dependency is only a &quot;module alias&quot; dependency (i.e. just on the name rather than the contents of the interface).</p><p>The compilation units loaded by this function are not added to the &quot;allowed units&quot; list (see <a href="#val-set_allowed_units"><code>set_allowed_units</code></a>) since they cannot be referenced from other compilation units.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-adapt_filename"><a href="#val-adapt_filename" class="anchor"></a><code><span><span class="keyword">val</span> adapt_filename : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>In bytecode, the identity function. In native code, replace the last extension with <code>.cmxs</code>.</p></div></div><h2 id="access-control"><a href="#access-control" class="anchor"></a>Access control</h2><div class="odoc-spec"><div class="spec value anchored" id="val-set_allowed_units"><a href="#val-set_allowed_units" class="anchor"></a><code><span><span class="keyword">val</span> set_allowed_units : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the list of compilation units that may be referenced from units that are dynamically loaded in the future to be exactly the given value.</p><p>Initially all compilation units composing the program currently running are available for reference from dynamically-linked units. <code>set_allowed_units</code> can be used to restrict access to a subset of these units, e.g. to the units that compose the API for dynamically-linked code, and prevent access to all other units, e.g. private, internal modules of the running program.</p><p>Note that <a href="#val-loadfile"><code>loadfile</code></a> changes the allowed-units list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allow_only"><a href="#val-allow_only" class="anchor"></a><code><span><span class="keyword">val</span> allow_only : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>allow_only units</code> sets the list of allowed units to be the intersection of the existing allowed units and the given list of units. As such it can never increase the set of allowed units.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-prohibit"><a href="#val-prohibit" class="anchor"></a><code><span><span class="keyword">val</span> prohibit : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>prohibit units</code> prohibits dynamically-linked units from referencing the units named in list <code>units</code> by removing such units from the allowed units list. This can be used to prevent access to selected units, e.g. private, internal modules of the running program.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-main_program_units"><a href="#val-main_program_units" class="anchor"></a><code><span><span class="keyword">val</span> main_program_units : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Return the list of compilation units that form the main program (i.e. are not dynamically linked).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-public_dynamically_loaded_units"><a href="#val-public_dynamically_loaded_units" class="anchor"></a><code><span><span class="keyword">val</span> public_dynamically_loaded_units : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Return the list of compilation units that have been dynamically loaded via <code>loadfile</code> (and not via <code>loadfile_private</code>). Note that compilation units loaded dynamically cannot be unloaded.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-all_units"><a href="#val-all_units" class="anchor"></a><code><span><span class="keyword">val</span> all_units : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Return the list of compilation units that form the main program together with those that have been dynamically loaded via <code>loadfile</code> (and not via <code>loadfile_private</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allow_unsafe_modules"><a href="#val-allow_unsafe_modules" class="anchor"></a><code><span><span class="keyword">val</span> allow_unsafe_modules : <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Govern whether unsafe object files are allowed to be dynamically linked. A compilation unit is 'unsafe' if it contains declarations of external functions, which can break type safety. By default, dynamic linking of unsafe object files is not allowed. In native code, this function does nothing; object files with external functions are always allowed to be dynamically linked.</p></div></div><h2 id="error-reporting"><a href="#error-reporting" class="anchor"></a>Error reporting</h2><div class="odoc-spec"><div class="spec type anchored" id="type-linking_error"><a href="#type-linking_error" class="anchor"></a><code><span><span class="keyword">type</span> linking_error</span><span> = <span class="keyword">private</span> </span></code><ol><li id="type-linking_error.Undefined_global" class="def variant constructor anchored"><a href="#type-linking_error.Undefined_global" class="anchor"></a><code><span>| </span><span><span class="constructor">Undefined_global</span> <span class="keyword">of</span> string</span></code></li><li id="type-linking_error.Unavailable_primitive" class="def variant constructor anchored"><a href="#type-linking_error.Unavailable_primitive" class="anchor"></a><code><span>| </span><span><span class="constructor">Unavailable_primitive</span> <span class="keyword">of</span> string</span></code></li><li id="type-linking_error.Uninitialized_global" class="def variant constructor anchored"><a href="#type-linking_error.Uninitialized_global" class="anchor"></a><code><span>| </span><span><span class="constructor">Uninitialized_global</span> <span class="keyword">of</span> string</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = <span class="keyword">private</span> </span></code><ol><li id="type-error.Not_a_bytecode_file" class="def variant constructor anchored"><a href="#type-error.Not_a_bytecode_file" class="anchor"></a><code><span>| </span><span><span class="constructor">Not_a_bytecode_file</span> <span class="keyword">of</span> string</span></code></li><li id="type-error.Inconsistent_import" class="def variant constructor anchored"><a href="#type-error.Inconsistent_import" class="anchor"></a><code><span>| </span><span><span class="constructor">Inconsistent_import</span> <span class="keyword">of</span> string</span></code></li><li id="type-error.Unavailable_unit" class="def variant constructor anchored"><a href="#type-error.Unavailable_unit" class="anchor"></a><code><span>| </span><span><span class="constructor">Unavailable_unit</span> <span class="keyword">of</span> string</span></code></li><li id="type-error.Unsafe_file" class="def variant constructor anchored"><a href="#type-error.Unsafe_file" class="anchor"></a><code><span>| </span><span><span class="constructor">Unsafe_file</span></span></code></li><li id="type-error.Linking_error" class="def variant constructor anchored"><a href="#type-error.Linking_error" class="anchor"></a><code><span>| </span><span><span class="constructor">Linking_error</span> <span class="keyword">of</span> string * <a href="#type-linking_error">linking_error</a></span></code></li><li id="type-error.Corrupted_interface" class="def variant constructor anchored"><a href="#type-error.Corrupted_interface" class="anchor"></a><code><span>| </span><span><span class="constructor">Corrupted_interface</span> <span class="keyword">of</span> string</span></code></li><li id="type-error.Cannot_open_dynamic_library" class="def variant constructor anchored"><a href="#type-error.Cannot_open_dynamic_library" class="anchor"></a><code><span>| </span><span><span class="constructor">Cannot_open_dynamic_library</span> <span class="keyword">of</span> exn</span></code></li><li id="type-error.Library's_module_initializers_failed" class="def variant constructor anchored"><a href="#type-error.Library's_module_initializers_failed" class="anchor"></a><code><span>| </span><span><span class="constructor">Library's_module_initializers_failed</span> <span class="keyword">of</span> exn</span></code></li><li id="type-error.Inconsistent_implementation" class="def variant constructor anchored"><a href="#type-error.Inconsistent_implementation" class="anchor"></a><code><span>| </span><span><span class="constructor">Inconsistent_implementation</span> <span class="keyword">of</span> string</span></code></li><li id="type-error.Module_already_loaded" class="def variant constructor anchored"><a href="#type-error.Module_already_loaded" class="anchor"></a><code><span>| </span><span><span class="constructor">Module_already_loaded</span> <span class="keyword">of</span> string</span></code></li><li id="type-error.Private_library_cannot_implement_interface" class="def variant constructor anchored"><a href="#type-error.Private_library_cannot_implement_interface" class="anchor"></a><code><span>| </span><span><span class="constructor">Private_library_cannot_implement_interface</span> <span class="keyword">of</span> string</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> <a href="#type-error">error</a></span></code></div><div class="spec-doc"><p>Errors in dynamic linking are reported by raising the <code>Error</code> exception with a description of the error. A common case is the dynamic library not being found on the system: this is reported via <code>Cannot_open_dynamic_library</code> (the enclosed exception may be platform-specific).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-error_message"><a href="#val-error_message" class="anchor"></a><code><span><span class="keyword">val</span> error_message : <span><a href="#type-error">error</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convert an error description to a printable message.</p></div></div></div></body></html>
